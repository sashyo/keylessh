<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="877px" preserveAspectRatio="none" style="width:873px;height:877px;background:#0F172A;" version="1.1" viewBox="0 0 873 877" width="873px" zoomAndPan="magnify"><title>HTTP Relay &#8212; Request Tunneling via WebSocket</title><defs/><g><rect fill="#0F172A" height="877" style="stroke:none;stroke-width:1;" width="873" x="0" y="0"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="602.0352" x="134.0049" y="35.4209">HTTP Relay &#8212; Request Tunneling via WebSocket</text><rect fill="#1E293B" height="346.5" style="stroke:#334155;stroke-width:1;" width="10" x="332.7695" y="418.1719"/><rect fill="#1E293B" height="193.7188" style="stroke:#334155;stroke-width:1;" width="10" x="584.3164" y="529.0156"/><line style="stroke:#334155;stroke-width:1;" x1="51" x2="51" y1="94.5469" y2="830.6094"/><line style="stroke:#334155;stroke-width:1;" x1="337.0449" x2="337.0449" y1="94.5469" y2="830.6094"/><line style="stroke:#334155;stroke-width:1;" x1="588.8281" x2="588.8281" y1="94.5469" y2="830.6094"/><line style="stroke:#334155;stroke-width:1;" x1="804.0488" x2="804.0488" y1="94.5469" y2="830.6094"/><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="62.8906" x="20" y="65.5781"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="48.8906" x="27" y="83.7168">Browser</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="62.8906" x="20" y="829.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="48.8906" x="27" y="847.748">Browser</text><rect fill="#1E293B" height="41.9375" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="91.4492" x="292.0449" y="51.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="75.873" x="299.833" y="69.748">STUN Server</text><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="77.4492" x="299.0449" y="83.7168">(HTTP + WS)</text><rect fill="#1E293B" height="41.9375" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="91.4492" x="292.0449" y="829.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="75.873" x="299.833" y="847.748">STUN Server</text><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="77.4492" x="299.0449" y="861.7168">(HTTP + WS)</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="40.9766" x="568.8281" y="65.5781"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="26.9766" x="575.8281" y="83.7168">WAF</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="40.9766" x="568.8281" y="829.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="26.9766" x="575.8281" y="847.748">WAF</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="92.9961" x="758.0488" y="65.5781"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="78.9961" x="765.0488" y="83.7168">Backend App</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="92.9961" x="758.0488" y="829.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="78.9961" x="765.0488" y="847.748">Backend App</text><rect fill="#1E293B" height="346.5" style="stroke:#334155;stroke-width:1;" width="10" x="332.7695" y="418.1719"/><rect fill="#1E293B" height="193.7188" style="stroke:#334155;stroke-width:1;" width="10" x="584.3164" y="529.0156"/><rect fill="#334155" height="3" style="stroke:#334155;stroke-width:1;" width="861.0449" x="5" y="124.5313"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="866.0449" y1="124.5313" y2="124.5313"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="866.0449" y1="127.5313" y2="127.5313"/><rect fill="#334155" height="21.9688" style="stroke:#000000;stroke-width:1;" width="126.043" x="372.501" y="114.5469"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="107.8652" x="378.501" y="129.6855">Portal Selection</text><polygon fill="#94A3B8" points="325.7695,162.4844,335.7695,166.4844,325.7695,170.4844,329.7695,166.4844" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="51.4453" x2="331.7695" y1="166.4844" y2="166.4844"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="67.3535" x="58.4453" y="161.6543">GET /portal</text><polygon fill="#94A3B8" points="62.4453,190.4531,52.4453,194.4531,62.4453,198.4531,58.4453,194.4531" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="56.4453" x2="336.7695" y1="194.4531" y2="194.4531"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="66.4336" x="68.4453" y="189.623">portal.html</text><polygon fill="#94A3B8" points="325.7695,218.4219,335.7695,222.4219,325.7695,226.4219,329.7695,222.4219" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="51.4453" x2="331.7695" y1="222.4219" y2="222.4219"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="82.0605" x="58.4453" y="217.5918">GET /api/wafs</text><polygon fill="#94A3B8" points="62.4453,246.3906,52.4453,250.3906,62.4453,254.3906,58.4453,250.3906" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="56.4453" x2="336.7695" y1="250.3906" y2="250.3906"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="252.2578" x="68.4453" y="245.5605">{ wafs: [{ id, displayName, backends }] }</text><polygon fill="#94A3B8" points="325.7695,274.3594,335.7695,278.3594,325.7695,282.3594,329.7695,278.3594" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="51.4453" x2="331.7695" y1="278.3594" y2="278.3594"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="262.3242" x="58.4453" y="273.5293">GET /api/select?waf=waf-x&amp;backend=App1</text><polygon fill="#94A3B8" points="62.4453,330.2656,52.4453,334.2656,62.4453,338.2656,58.4453,334.2656" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="56.4453" x2="336.7695" y1="334.2656" y2="334.2656"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="89.543" x="68.4453" y="301.498">302 /__b/App1/</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="172.998" x="68.4453" y="315.4668">Set-Cookie: waf_relay=waf-x</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="192.2695" x="68.4453" y="329.4355">Set-Cookie: waf_backend=App1</text><rect fill="#334155" height="3" style="stroke:#334155;stroke-width:1;" width="861.0449" x="5" y="362.25"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="866.0449" y1="362.25" y2="362.25"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="866.0449" y1="365.25" y2="365.25"/><rect fill="#334155" height="21.9688" style="stroke:#000000;stroke-width:1;" width="313.1504" x="278.9473" y="352.2656"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="294.9727" x="284.9473" y="367.4043">HTTP Relay (every request before WebRTC)</text><polygon fill="#94A3B8" points="320.7695,414.1719,330.7695,418.1719,320.7695,422.1719,324.7695,418.1719" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="51.4453" x2="326.7695" y1="418.1719" y2="418.1719"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="154.541" x="58.4453" y="399.373">GET /__b/App1/dashboard</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="148.9629" x="58.4453" y="413.3418">Cookie: waf_relay=waf-x</text><line style="stroke:#94A3B8;stroke-width:1;" x1="342.7695" x2="384.7695" y1="446.1406" y2="446.1406"/><line style="stroke:#94A3B8;stroke-width:1;" x1="384.7695" x2="384.7695" y1="446.1406" y2="459.1406"/><line style="stroke:#94A3B8;stroke-width:1;" x1="343.7695" x2="384.7695" y1="459.1406" y2="459.1406"/><polygon fill="#94A3B8" points="353.7695,455.1406,343.7695,459.1406,353.7695,463.1406,349.7695,459.1406" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="135.2402" x="349.7695" y="441.3105">Cookie lookup &#8594; waf-x</text><polygon fill="#94A3B8" points="572.3164,525.0156,582.3164,529.0156,572.3164,533.0156,576.3164,529.0156" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="342.7695" x2="578.3164" y1="529.0156" y2="529.0156"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="103.8516" x="349.7695" y="482.2793">WS: http_request</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="180.3164" x="349.7695" y="496.248">{ id: "uuid-1", method: "GET",</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="165.0996" x="357.3984" y="510.2168">url: "/__b/App1/dashboard",</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="150.75" x="357.3984" y="524.1855">headers: {...}, body: "" }</text><line style="stroke:#94A3B8;stroke-width:1;" x1="594.3164" x2="636.3164" y1="570.9531" y2="570.9531"/><line style="stroke:#94A3B8;stroke-width:1;" x1="636.3164" x2="636.3164" y1="570.9531" y2="583.9531"/><line style="stroke:#94A3B8;stroke-width:1;" x1="595.3164" x2="636.3164" y1="583.9531" y2="583.9531"/><polygon fill="#94A3B8" points="605.3164,579.9531,595.3164,583.9531,605.3164,587.9531,601.3164,583.9531" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="142.4297" x="601.3164" y="552.1543">HTTP to 127.0.0.1:7891</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="181.2305" x="601.3164" y="566.123">(loopback through own proxy)</text><line style="stroke:#94A3B8;stroke-width:1;" x1="594.3164" x2="636.3164" y1="639.8594" y2="639.8594"/><line style="stroke:#94A3B8;stroke-width:1;" x1="636.3164" x2="636.3164" y1="639.8594" y2="652.8594"/><line style="stroke:#94A3B8;stroke-width:1;" x1="595.3164" x2="636.3164" y1="652.8594" y2="652.8594"/><polygon fill="#94A3B8" points="605.3164,648.8594,595.3164,652.8594,605.3164,656.8594,601.3164,652.8594" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="129.2109" x="601.3164" y="607.0918">Strip /__b/App1 prefix</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="142.7988" x="601.3164" y="621.0605">Check JWT &#8594; not auth'd</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="105.1758" x="601.3164" y="635.0293">&#8594; 302 /auth/login</text><polygon fill="#94A3B8" points="353.7695,718.7344,343.7695,722.7344,353.7695,726.7344,349.7695,722.7344" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="347.7695" x2="588.3164" y1="722.7344" y2="722.7344"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="112.7402" x="359.7695" y="675.998">WS: http_response</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="189.2227" x="359.7695" y="689.9668">{ id: "uuid-1", statusCode: 302,</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="209.918" x="367.3984" y="703.9355">headers: {Location: "/auth/login"},</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="60.0234" x="367.3984" y="717.9043">body: "" }</text><polygon fill="#94A3B8" points="62.4453,760.6719,52.4453,764.6719,62.4453,768.6719,58.4453,764.6719" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="56.4453" x2="336.7695" y1="764.6719" y2="764.6719"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="126.041" x="68.4453" y="745.873">HTTP 302 /auth/login</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="172.998" x="68.4453" y="759.8418">Set-Cookie: waf_relay=waf-x</text><path d="M218,777.6719 L218,814.6719 L456,814.6719 L456,787.6719 L446,777.6719 L218,777.6719 " fill="#1E293B" style="stroke:#334155;stroke-width:1;"/><path d="M446,777.6719 L446,787.6719 L456,787.6719 L446,777.6719 " fill="#1E293B" style="stroke:#334155;stroke-width:1;"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="147.4219" x="224" y="793.8105">30s timeout &#8594; HTTP 504</text><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="217.1602" x="224" y="807.7793">Session affinity via waf_relay cookie</text><!--SRC=[ZLLjJzim4FwUNt7Bf0qq-WeCgDHDh1ji4qA85F5XdP3RN1ghgPtPJg53bVPfFs3QB-INxEoqfQ6XcggeiU-vk-SUdoylJ8nZX3HXN7Y6cmJXSxTx0PUOi2ay_FfBRpyor0QwcH2OS3642MTmZVr03aPeF4-Fk4YPOcEuzm3wR30QAfc9i2CJgU1bFMeSD1bPGenObfWJASpS51r6B1eKJUUCwFW13YN2rHU_Q0puJuH6apO3oqeCy8n7z0Zy85M8QXvtTtUliRzVXdfAhe7Dezq-8I-OCdp0KoRC_u4A-Vg7pUXj4L1Mvh5IydQ-URJ7o6snkO9U6iwbsK3OMKkBjfQox0inJYbU-dpW8coZh1_vX9DvBTPpm7LMCyzB7pK3_mDfeL7vm3Jqy_SbjG8mw5wTKtWrGTKJMwvbty1riEqyjSb4kTlryOb3tBAe761hGH72SPhc9ERh1TXhj-52AiCIofxWm70feDtsl0NRohiyVGjEFtMXbZgivxOgP5l0Mf1Rgh4P9yzwivJNYAekyx-tHUWMVBi77kv0o3LTugczFZiBrXfcts6sCRfsHRodK6rwAdUlvgvj4g1HbdQtteJQpKs_PW6rdWZGL3fIZZYsBA4RPGT77clTM0XkfLoPDLj8Ppa5DHytVOoaGZjdBhkTxKqIByc4JCTzoLJO4yymyXWTs8GPT06yUNtBSBaN9FINfV3m-m_aNakSRPiMjLaBOcFIcpdNdh17q08_otXOQVWxC4OJIxj31FsTdW38L4BB4gwvEKP6zuDEyxvQhSxe06Ku9RnFfxUaJCazpp9O4d7g6KaJyQ1Qfr-ZTN1urA3xG1MaLcimCTtBOGpoLa2gvDrq-qc8m2YUFcf888mudLmdHdB_UjrrCWXfW6KcVatIshLh0hjHI-IGFXnvp4SXLnJIgHGQroNIXfbCTsI8hgUUg70c1ynUBQlPOnv_vc0hueHObAUaOPr8JmXlRDlLe7cRKFa8ajepNmE5qs3u66Lcd3ukntvzpuqyhUrCO5741JTJzxLSPe21o-dPaMAZUly0]--></g></svg>