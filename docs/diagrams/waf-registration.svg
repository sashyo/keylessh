<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="738px" preserveAspectRatio="none" style="width:620px;height:738px;background:#0F172A;" version="1.1" viewBox="0 0 620 738" width="620px" zoomAndPan="magnify"><title>WAF Registration &amp; Client Pairing</title><defs/><g><rect fill="#0F172A" height="738" style="stroke:none;stroke-width:1;" width="620" x="0" y="0"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="420.0732" x="98.9497" y="35.4209">WAF Registration &amp; Client Pairing</text><rect fill="#1E293B" height="507.2813" style="stroke:#334155;stroke-width:1;" width="10" x="324.498" y="166.4844"/><rect fill="#1E293B" height="208.6875" style="stroke:#334155;stroke-width:1;" width="10" x="562.5273" y="465.0781"/><line style="stroke:#334155;stroke-width:1;" x1="49" x2="49" y1="94.5469" y2="691.7656"/><line style="stroke:#334155;stroke-width:1;" x1="328.5615" x2="328.5615" y1="94.5469" y2="691.7656"/><line style="stroke:#334155;stroke-width:1;" x1="567.082" x2="567.082" y1="94.5469" y2="691.7656"/><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="40.9766" x="29" y="65.5781"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="26.9766" x="36" y="83.7168">WAF</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="40.9766" x="29" y="690.7656"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="26.9766" x="36" y="708.9043">WAF</text><rect fill="#1E293B" height="41.9375" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="89.873" x="284.5615" y="51.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="75.873" x="291.5615" y="69.748">STUN Server</text><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="63.416" x="297.79" y="83.7168">(signaling)</text><rect fill="#1E293B" height="41.9375" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="89.873" x="284.5615" y="690.7656"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="75.873" x="291.5615" y="708.9043">STUN Server</text><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="63.416" x="297.79" y="722.873">(signaling)</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="62.8906" x="536.082" y="65.5781"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="48.8906" x="543.082" y="83.7168">Browser</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="62.8906" x="536.082" y="690.7656"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="48.8906" x="543.082" y="708.9043">Browser</text><rect fill="#1E293B" height="507.2813" style="stroke:#334155;stroke-width:1;" width="10" x="324.498" y="166.4844"/><rect fill="#1E293B" height="208.6875" style="stroke:#334155;stroke-width:1;" width="10" x="562.5273" y="465.0781"/><rect fill="#334155" height="3" style="stroke:#334155;stroke-width:1;" width="608.9727" x="5" y="124.5313"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="613.9727" y1="124.5313" y2="124.5313"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="613.9727" y1="127.5313" y2="127.5313"/><rect fill="#334155" height="21.9688" style="stroke:#000000;stroke-width:1;" width="136.6895" x="241.1416" y="114.5469"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="118.5117" x="247.1416" y="129.6855">WAF Registration</text><polygon fill="#94A3B8" points="312.498,162.4844,322.498,166.4844,312.498,170.4844,316.498,166.4844" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="49.4883" x2="318.498" y1="166.4844" y2="166.4844"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="119.1094" x="56.4883" y="161.6543">WebSocket connect</text><polygon fill="#94A3B8" points="312.498,246.3281,322.498,250.3281,312.498,254.3281,316.498,250.3281" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="49.4883" x2="318.498" y1="250.3281" y2="250.3281"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="46.541" x="56.4883" y="189.623">register</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="148.8457" x="56.4883" y="203.5918">{ role: "waf", id: "waf-x",</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="71.4082" x="64.1172" y="217.5605">secret: "...",</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="177.3164" x="64.1172" y="231.5293">addresses: ["10.0.0.5:7891"],</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="243.3809" x="64.1172" y="245.498">metadata: { displayName, backends } }</text><line style="stroke:#94A3B8;stroke-width:1;" x1="334.498" x2="376.498" y1="292.2656" y2="292.2656"/><line style="stroke:#94A3B8;stroke-width:1;" x1="376.498" x2="376.498" y1="292.2656" y2="305.2656"/><line style="stroke:#94A3B8;stroke-width:1;" x1="335.498" x2="376.498" y1="305.2656" y2="305.2656"/><polygon fill="#94A3B8" points="345.498,301.2656,335.498,305.2656,345.498,309.2656,341.498,305.2656" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="124.916" x="341.498" y="273.4668">Validate API_SECRET</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="89.3789" x="341.498" y="287.4355">Add to registry</text><polygon fill="#94A3B8" points="60.4883,343.2031,50.4883,347.2031,60.4883,351.2031,56.4883,347.2031" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="54.4883" x2="323.498" y1="347.2031" y2="347.2031"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="61.541" x="66.4883" y="328.4043">registered</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="156.4805" x="66.4883" y="342.373">{ role: "waf", id: "waf-x" }</text><path d="M10,360.2031 L10,397.2031 L370,397.2031 L370,370.2031 L360,360.2031 L10,360.2031 " fill="#1E293B" style="stroke:#334155;stroke-width:1;"/><path d="M360,360.2031 L360,370.2031 L370,370.2031 L360,360.2031 " fill="#1E293B" style="stroke:#334155;stroke-width:1;"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="175.2246" x="73.2642" y="376.3418">WAF keeps WebSocket open.</text><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="224.9063" x="73.2642" y="390.3105">Reconnects on disconnect (5s delay).</text><rect fill="#334155" height="3" style="stroke:#334155;stroke-width:1;" width="608.9727" x="5" y="423.125"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="613.9727" y1="423.125" y2="423.125"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="613.9727" y1="426.125" y2="426.125"/><rect fill="#334155" height="21.9688" style="stroke:#000000;stroke-width:1;" width="124.0742" x="247.4492" y="413.1406"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="105.8965" x="253.4492" y="428.2793">Client Connects</text><polygon fill="#94A3B8" points="345.498,461.0781,335.498,465.0781,345.498,469.0781,341.498,465.0781" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="339.498" x2="561.5273" y1="465.0781" y2="465.0781"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="119.1094" x="351.498" y="460.248">WebSocket connect</text><polygon fill="#94A3B8" points="345.498,503.0156,335.498,507.0156,345.498,511.0156,341.498,507.0156" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="339.498" x2="561.5273" y1="507.0156" y2="507.0156"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="46.541" x="351.498" y="488.2168">register</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="194.0801" x="351.498" y="502.1855">{ role: "client", id: "client-abc" }</text><line style="stroke:#94A3B8;stroke-width:1;" x1="334.498" x2="376.498" y1="548.9531" y2="548.9531"/><line style="stroke:#94A3B8;stroke-width:1;" x1="376.498" x2="376.498" y1="548.9531" y2="561.9531"/><line style="stroke:#94A3B8;stroke-width:1;" x1="335.498" x2="376.498" y1="561.9531" y2="561.9531"/><polygon fill="#94A3B8" points="345.498,557.9531,335.498,561.9531,345.498,565.9531,341.498,561.9531" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="134.0684" x="341.498" y="530.1543">Find least-loaded WAF</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="125.543" x="341.498" y="544.123">Pair client with waf-x</text><polygon fill="#94A3B8" points="550.5273,613.8594,560.5273,617.8594,550.5273,621.8594,554.5273,617.8594" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="334.498" x2="556.5273" y1="617.8594" y2="617.8594"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="38.2383" x="341.498" y="585.0918">paired</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="118.6348" x="341.498" y="599.0605">{ waf: { id: "waf-x",</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="196.4004" x="349.127" y="613.0293">addresses: ["10.0.0.5:7891"] } }</text><polygon fill="#94A3B8" points="60.4883,669.7656,50.4883,673.7656,60.4883,677.7656,56.4883,673.7656" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="54.4883" x2="328.498" y1="673.7656" y2="673.7656"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="38.2383" x="66.4883" y="640.998">paired</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="156.2344" x="66.4883" y="654.9668">{ client: { id: "client-abc",</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="184.2188" x="74.1172" y="668.9355">reflexiveAddress: "1.2.3.4" } }</text><!--SRC=[ZLHXJzim4FsUNt7Bf0caDY8j7L2faqe74zA448NnOPqcDxuKgy7ERBV04FzzPoTf6vfLgAeK-zwzU_VEzWTxZmy8USQ43Aom6SBTy1okSIQCrSmA9U4JZ3A1qi8L4rh8MH2OkP0vq-m1NWA0AKlcCwqMaezKfZHyF4ZZemwZ2CUKBJ9xhgGjG-bnojAa7hfaf20SuqmXt5w4zU1O_4M8ExGvnZyBb0b-5odz9PugpL6NlDtkOTphDQ7UYeknSzAT4lAAQIiIaJDftmUgrPiUTzBFTK1JcqEjrMEvUNB8AAtQt42l0fVAxX3ieurDkqXJzSgCRyIN_v-u3jjfguViAlLLB0NbRnNROYg1srolGP2lJOMGpcC8pC0ZIrUQQu3npUqbqUebwedSCs8cMKR7TDzd6RkGpMcdD0I3sgEcnVSA60m6s_TWC0W29wBzfM3jmnrEnogPeuL4IOc93LXYnP9Pz8YtSEtPdCeNq2h3FeG425iWUF7PVWfR4mbWCD5eQI-AecA7SQxH63Hz-1d61v7xzVf7noTn-Ci37j0opYphmmjmOUX2FxjxrVAt4oKty0hah5UoLlI3dE9Exl3gulVuR7HzTZEHGyx1gbAjVgwIACkrisu3-Qv6N3L9vn8KpSLbjWfFm1ixHypDXdygHnbHx1fB9msGuzH8kOIzdg5dWRhQZm9g1nor7rFvDesgD3UbQfplcbG9Rifg65ZYorMj5giscoPXWxldWeHco8njPufnvAxrYNJFA1IPy2ZiFNZ3DcokXFGX9sXXCs7SQD-Ub5tdOdFYg-6j6Gi5AzADLZopnZJ39x74OL62877KYRhHOLWGSwmVzerrPUa_]--></g></svg>