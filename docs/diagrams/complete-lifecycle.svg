<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1875px" preserveAspectRatio="none" style="width:1256px;height:1875px;background:#0F172A;" version="1.1" viewBox="0 0 1256 1875" width="1256px" zoomAndPan="magnify"><title>Complete Connection Lifecycle &#8212; Portal to P2P</title><defs/><g><rect fill="#0F172A" height="1875" style="stroke:none;stroke-width:1;" width="1256" x="0" y="0"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="22" font-weight="bold" lengthAdjust="spacing" textLength="582.2803" x="335.7256" y="35.4209">Complete Connection Lifecycle &#8212; Portal to P2P</text><line style="stroke:#334155;stroke-width:1;" x1="26" x2="26" y1="126.5781" y2="1796.8281"/><line style="stroke:#334155;stroke-width:1;" x1="196.9492" x2="196.9492" y1="126.5781" y2="1796.8281"/><line style="stroke:#334155;stroke-width:1;" x1="558.3096" x2="558.3096" y1="126.5781" y2="1796.8281"/><line style="stroke:#334155;stroke-width:1;" x1="841.5313" x2="841.5313" y1="126.5781" y2="1796.8281"/><line style="stroke:#334155;stroke-width:1;" x1="1101.9717" x2="1101.9717" y1="126.5781" y2="1796.8281"/><line style="stroke:#334155;stroke-width:1;" x1="1200.9932" x2="1200.9932" y1="126.5781" y2="1796.8281"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="27.3516" x="10" y="123.748">User</text><ellipse cx="26.6758" cy="60.6094" fill="#3B82F6" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M26.6758,68.6094 L26.6758,95.6094 M13.6758,76.6094 L39.6758,76.6094 M26.6758,95.6094 L13.6758,110.6094 M26.6758,95.6094 L39.6758,110.6094 " fill="none" style="stroke:#000000;stroke-width:1;"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="27.3516" x="10" y="1806.9668">User</text><ellipse cx="26.6758" cy="1818.7969" fill="#3B82F6" rx="8" ry="8" style="stroke:#000000;stroke-width:1;"/><path d="M26.6758,1826.7969 L26.6758,1853.7969 M13.6758,1834.7969 L39.6758,1834.7969 M26.6758,1853.7969 L13.6758,1868.7969 M26.6758,1853.7969 L39.6758,1868.7969 " fill="none" style="stroke:#000000;stroke-width:1;"/><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="62.8906" x="165.9492" y="97.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="48.8906" x="172.9492" y="115.748">Browser</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="62.8906" x="165.9492" y="1795.8281"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="48.8906" x="172.9492" y="1813.9668">Browser</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="89.873" x="514.3096" y="97.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="75.873" x="521.3096" y="115.748">STUN Server</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="89.873" x="514.3096" y="1795.8281"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="75.873" x="521.3096" y="1813.9668">STUN Server</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="40.9766" x="821.5313" y="97.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="26.9766" x="828.5313" y="115.748">WAF</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="40.9766" x="821.5313" y="1795.8281"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="26.9766" x="828.5313" y="1813.9668">WAF</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="73.0215" x="1065.9717" y="97.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="59.0215" x="1072.9717" y="115.748">TideCloak</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="73.0215" x="1065.9717" y="1795.8281"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="59.0215" x="1072.9717" y="1813.9668">TideCloak</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="65.7383" x="1168.9932" y="97.6094"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="51.7383" x="1175.9932" y="115.748">Backend</text><rect fill="#1E293B" height="27.9688" rx="2.5" ry="2.5" style="stroke:#3B82F6;stroke-width:1;" width="65.7383" x="1168.9932" y="1795.8281"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="51.7383" x="1175.9932" y="1813.9668">Backend</text><rect fill="#334155" height="3" style="stroke:#334155;stroke-width:1;" width="1244.7314" x="5" y="156.5625"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1249.7314" y1="156.5625" y2="156.5625"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1249.7314" y1="159.5625" y2="159.5625"/><rect fill="#334155" height="21.9688" style="stroke:#000000;stroke-width:1;" width="121.3027" x="566.7144" y="146.5781"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="103.125" x="572.7144" y="161.7168">Phase 1: Portal</text><polygon fill="#94A3B8" points="185.3945,194.5156,195.3945,198.5156,185.3945,202.5156,189.3945,198.5156" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="26.6758" x2="191.3945" y1="198.5156" y2="198.5156"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="125.7539" x="33.6758" y="193.6855">Visit stun-server URL</text><polygon fill="#94A3B8" points="547.2461,222.4844,557.2461,226.4844,547.2461,230.4844,551.2461,226.4844" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="226.4844" y2="226.4844"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="67.3535" x="204.3945" y="221.6543">GET /portal</text><polygon fill="#94A3B8" points="208.3945,250.4531,198.3945,254.4531,208.3945,258.4531,204.3945,254.4531" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="202.3945" x2="558.2461" y1="254.4531" y2="254.4531"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="66.4336" x="214.3945" y="249.623">portal.html</text><polygon fill="#94A3B8" points="547.2461,278.4219,557.2461,282.4219,547.2461,286.4219,551.2461,282.4219" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="282.4219" y2="282.4219"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="82.0605" x="204.3945" y="277.5918">GET /api/wafs</text><polygon fill="#94A3B8" points="208.3945,306.3906,198.3945,310.3906,208.3945,314.3906,204.3945,310.3906" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="202.3945" x2="558.2461" y1="310.3906" y2="310.3906"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="337.8516" x="214.3945" y="305.5605">[{ id: "waf-x", displayName: "My App", backends: [...] }]</text><polygon fill="#94A3B8" points="185.3945,334.3594,195.3945,338.3594,185.3945,342.3594,189.3945,338.3594" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="26.6758" x2="191.3945" y1="338.3594" y2="338.3594"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="146.7188" x="33.6758" y="333.5293">Click "Connect" on App1</text><polygon fill="#94A3B8" points="547.2461,362.3281,557.2461,366.3281,547.2461,370.3281,551.2461,366.3281" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="366.3281" y2="366.3281"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="262.3242" x="204.3945" y="361.498">GET /api/select?waf=waf-x&amp;backend=App1</text><polygon fill="#94A3B8" points="208.3945,390.2969,198.3945,394.2969,208.3945,398.2969,204.3945,394.2969" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="202.3945" x2="558.2461" y1="394.2969" y2="394.2969"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="152.4258" x="214.3945" y="389.4668">302 /__b/App1/ + cookies</text><rect fill="#334155" height="3" style="stroke:#334155;stroke-width:1;" width="1244.7314" x="5" y="422.2813"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1249.7314" y1="422.2813" y2="422.2813"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1249.7314" y1="425.2813" y2="425.2813"/><rect fill="#334155" height="21.9688" style="stroke:#000000;stroke-width:1;" width="207.7168" x="523.5073" y="412.2969"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="189.5391" x="529.5073" y="427.4355">Phase 2: HTTP Relay + Auth</text><polygon fill="#94A3B8" points="547.2461,460.2344,557.2461,464.2344,547.2461,468.2344,551.2461,464.2344" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="464.2344" y2="464.2344"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="252.9902" x="204.3945" y="459.4043">GET /__b/App1/ (Cookie: waf_relay=waf-x)</text><polygon fill="#94A3B8" points="830.0195,488.2031,840.0195,492.2031,830.0195,496.2031,834.0195,492.2031" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="559.2461" x2="836.0195" y1="492.2031" y2="492.2031"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="147.1348" x="566.2461" y="487.373">WS: http_request (relay)</text><polygon fill="#94A3B8" points="570.2461,516.1719,560.2461,520.1719,570.2461,524.1719,566.2461,520.1719" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="564.2461" x2="841.0195" y1="520.1719" y2="520.1719"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="221.7305" x="576.2461" y="515.3418">WS: http_response 302 &#8594; /auth/login</text><polygon fill="#94A3B8" points="208.3945,544.1406,198.3945,548.1406,208.3945,552.1406,204.3945,548.1406" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="202.3945" x2="558.2461" y1="548.1406" y2="548.1406"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="91.3066" x="214.3945" y="543.3105">302 /auth/login</text><polygon fill="#94A3B8" points="547.2461,572.1094,557.2461,576.1094,547.2461,580.1094,551.2461,576.1094" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="576.1094" y2="576.1094"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="288.4863" x="204.3945" y="571.2793">GET /auth/login &#8594; relay &#8594; WAF &#8594; 302 TideCloak</text><polygon fill="#94A3B8" points="547.2461,600.0781,557.2461,604.0781,547.2461,608.0781,551.2461,604.0781" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="604.0781" y2="604.0781"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="311.4258" x="204.3945" y="599.248">GET /realms/... &#8594; relay &#8594; WAF &#8594; proxy to TideCloak</text><polygon fill="#94A3B8" points="208.3945,628.0469,198.3945,632.0469,208.3945,636.0469,204.3945,632.0469" style="stroke:#94A3B8;stroke-width:1;"/><polygon fill="#94A3B8" points="1090.4824,628.0469,1100.4824,632.0469,1090.4824,636.0469,1094.4824,632.0469" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="202.3945" x2="1096.4824" y1="632.0469" y2="632.0469"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="173.1094" x="214.3945" y="627.2168">Login (proxied through WAF)</text><polygon fill="#94A3B8" points="547.2461,656.0156,557.2461,660.0156,547.2461,664.0156,551.2461,660.0156" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="660.0156" y2="660.0156"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="270.832" x="204.3945" y="655.1855">GET /auth/callback?code=xyz &#8594; relay &#8594; WAF</text><polygon fill="#94A3B8" points="1090.4824,683.9844,1100.4824,687.9844,1090.4824,691.9844,1094.4824,687.9844" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="842.0195" x2="1096.4824" y1="687.9844" y2="687.9844"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="155.9648" x="849.0195" y="683.1543">Exchange code for tokens</text><polygon fill="#94A3B8" points="570.2461,711.9531,560.2461,715.9531,570.2461,719.9531,566.2461,715.9531" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="564.2461" x2="841.0195" y1="715.9531" y2="715.9531"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="258.7734" x="576.2461" y="711.123">302 + Set-Cookie: waf_access, waf_refresh</text><polygon fill="#94A3B8" points="208.3945,739.9219,198.3945,743.9219,208.3945,747.9219,204.3945,743.9219" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="202.3945" x2="558.2461" y1="743.9219" y2="743.9219"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="183.5098" x="214.3945" y="739.0918">302 /__b/App1/ + auth cookies</text><polygon fill="#94A3B8" points="547.2461,767.8906,557.2461,771.8906,547.2461,775.8906,551.2461,771.8906" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="771.8906" y2="771.8906"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="198.7969" x="204.3945" y="767.0605">GET /__b/App1/ (with JWT cookie)</text><polygon fill="#94A3B8" points="830.0195,795.8594,840.0195,799.8594,830.0195,803.8594,834.0195,799.8594" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="559.2461" x2="836.0195" y1="799.8594" y2="799.8594"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="147.1348" x="566.2461" y="795.0293">WS: http_request (relay)</text><polygon fill="#94A3B8" points="1189.8623,823.8281,1199.8623,827.8281,1189.8623,831.8281,1193.8623,827.8281" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="842.0195" x2="1195.8623" y1="827.8281" y2="827.8281"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="129.1992" x="849.0195" y="822.998">GET / (authenticated)</text><polygon fill="#94A3B8" points="853.0195,851.7969,843.0195,855.7969,853.0195,859.7969,849.0195,855.7969" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="847.0195" x2="1200.8623" y1="855.7969" y2="855.7969"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="60.1113" x="859.0195" y="850.9668">200 HTML</text><line style="stroke:#94A3B8;stroke-width:1;" x1="842.0195" x2="884.0195" y1="883.7656" y2="883.7656"/><line style="stroke:#94A3B8;stroke-width:1;" x1="884.0195" x2="884.0195" y1="883.7656" y2="896.7656"/><line style="stroke:#94A3B8;stroke-width:1;" x1="843.0195" x2="884.0195" y1="896.7656" y2="896.7656"/><polygon fill="#94A3B8" points="853.0195,892.7656,843.0195,896.7656,853.0195,900.7656,849.0195,896.7656" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="246.4629" x="849.0195" y="878.9355">Rewrite HTML + inject webrtc-upgrade.js</text><polygon fill="#94A3B8" points="570.2461,920.7344,560.2461,924.7344,570.2461,928.7344,566.2461,924.7344" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="564.2461" x2="841.0195" y1="924.7344" y2="924.7344"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="112.7402" x="576.2461" y="919.9043">WS: http_response</text><polygon fill="#94A3B8" points="208.3945,948.7031,198.3945,952.7031,208.3945,956.7031,204.3945,952.7031" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="202.3945" x2="558.2461" y1="952.7031" y2="952.7031"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="197.5195" x="214.3945" y="947.873">200 (app page + upgrade script)</text><rect fill="#334155" height="3" style="stroke:#334155;stroke-width:1;" width="1244.7314" x="5" y="980.6875"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1249.7314" y1="980.6875" y2="980.6875"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1249.7314" y1="983.6875" y2="983.6875"/><rect fill="#334155" height="21.9688" style="stroke:#000000;stroke-width:1;" width="341.252" x="456.7397" y="970.7031"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="323.0742" x="462.7397" y="985.8418">Phase 3: WebRTC Upgrade (async, background)</text><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="239.3945" y1="1022.6406" y2="1022.6406"/><line style="stroke:#94A3B8;stroke-width:1;" x1="239.3945" x2="239.3945" y1="1022.6406" y2="1035.6406"/><line style="stroke:#94A3B8;stroke-width:1;" x1="198.3945" x2="239.3945" y1="1035.6406" y2="1035.6406"/><polygon fill="#94A3B8" points="208.3945,1031.6406,198.3945,1035.6406,208.3945,1039.6406,204.3945,1035.6406" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="167.1328" x="204.3945" y="1017.8105">webrtc-upgrade.js executes</text><polygon fill="#94A3B8" points="547.2461,1059.6094,557.2461,1063.6094,547.2461,1067.6094,551.2461,1063.6094" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="1063.6094" y2="1063.6094"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="175.4414" x="204.3945" y="1058.7793">WS: register { role: "client" }</text><polygon fill="#94A3B8" points="208.3945,1087.5781,198.3945,1091.5781,208.3945,1095.5781,204.3945,1091.5781" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="202.3945" x2="558.2461" y1="1091.5781" y2="1091.5781"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="138.0645" x="214.3945" y="1086.748">paired { waf: "waf-x" }</text><polygon fill="#94A3B8" points="830.0195,1115.5469,840.0195,1119.5469,830.0195,1123.5469,834.0195,1119.5469" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="559.2461" x2="836.0195" y1="1119.5469" y2="1119.5469"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="175.6641" x="566.2461" y="1114.7168">paired { client: "client-abc" }</text><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="239.3945" y1="1147.5156" y2="1147.5156"/><line style="stroke:#94A3B8;stroke-width:1;" x1="239.3945" x2="239.3945" y1="1147.5156" y2="1160.5156"/><line style="stroke:#94A3B8;stroke-width:1;" x1="198.3945" x2="239.3945" y1="1160.5156" y2="1160.5156"/><polygon fill="#94A3B8" points="208.3945,1156.5156,198.3945,1160.5156,208.3945,1164.5156,204.3945,1160.5156" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="233.748" x="204.3945" y="1142.6855">new RTCPeerConnection + createOffer</text><polygon fill="#94A3B8" points="547.2461,1184.4844,557.2461,1188.4844,547.2461,1192.4844,551.2461,1188.4844" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="553.2461" y1="1188.4844" y2="1188.4844"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="55.5938" x="204.3945" y="1183.6543">sdp_offer</text><polygon fill="#94A3B8" points="830.0195,1212.4531,840.0195,1216.4531,830.0195,1220.4531,834.0195,1216.4531" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="559.2461" x2="836.0195" y1="1216.4531" y2="1216.4531"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="105.627" x="566.2461" y="1211.623">forward sdp_offer</text><polygon fill="#94A3B8" points="570.2461,1240.4219,560.2461,1244.4219,570.2461,1248.4219,566.2461,1244.4219" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="564.2461" x2="841.0195" y1="1244.4219" y2="1244.4219"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="70.8281" x="576.2461" y="1239.5918">sdp_answer</text><polygon fill="#94A3B8" points="208.3945,1268.3906,198.3945,1272.3906,208.3945,1276.3906,204.3945,1272.3906" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="202.3945" x2="558.2461" y1="1272.3906" y2="1272.3906"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="120.8613" x="214.3945" y="1267.5605">forward sdp_answer</text><polygon fill="#94A3B8" points="208.3945,1310.3281,198.3945,1314.3281,208.3945,1318.3281,204.3945,1314.3281" style="stroke:#94A3B8;stroke-width:1;"/><polygon fill="#94A3B8" points="547.2461,1310.3281,557.2461,1314.3281,547.2461,1318.3281,551.2461,1314.3281" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="202.3945" x2="553.2461" y1="1314.3281" y2="1314.3281"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="153.9961" x="214.3945" y="1295.5293">STUN Binding (port 3478)</text><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="171.6445" x="214.3945" y="1309.498">&#8594; discover reflexive address</text><polygon fill="#94A3B8" points="208.3945,1338.2969,198.3945,1342.2969,208.3945,1346.2969,204.3945,1342.2969" style="stroke:#94A3B8;stroke-width:1;"/><polygon fill="#94A3B8" points="547.2461,1338.2969,557.2461,1342.2969,547.2461,1346.2969,551.2461,1342.2969" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="202.3945" x2="553.2461" y1="1342.2969" y2="1342.2969"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="232.8047" x="214.3945" y="1337.4668">ICE candidates &#8592;&#8594; forwarded &#8592;&#8594; WAF</text><polygon fill="#94A3B8" points="208.3945,1366.2656,198.3945,1370.2656,208.3945,1374.2656,204.3945,1370.2656" style="stroke:#94A3B8;stroke-width:1;"/><polygon fill="#94A3B8" points="830.0195,1366.2656,840.0195,1370.2656,830.0195,1374.2656,834.0195,1370.2656" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="202.3945" x2="836.0195" y1="1370.2656" y2="1370.2656"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="266.9121" x="214.3945" y="1365.4355">ICE connectivity check &#8594; hole punched!</text><polygon fill="#94A3B8" points="208.3945,1394.2344,198.3945,1398.2344,208.3945,1402.2344,204.3945,1398.2344" style="stroke:#94A3B8;stroke-width:1;"/><polygon fill="#94A3B8" points="830.0195,1394.2344,840.0195,1398.2344,830.0195,1402.2344,834.0195,1398.2344" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="202.3945" x2="836.0195" y1="1398.2344" y2="1398.2344"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="128.0918" x="214.3945" y="1393.4043">DataChannel OPEN</text><rect fill="#334155" height="3" style="stroke:#334155;stroke-width:1;" width="1244.7314" x="5" y="1426.2188"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1249.7314" y1="1426.2188" y2="1426.2188"/><line style="stroke:#000000;stroke-width:0.5;" x1="5" x2="1249.7314" y1="1429.2188" y2="1429.2188"/><rect fill="#334155" height="21.9688" style="stroke:#000000;stroke-width:1;" width="250.6016" x="502.0649" y="1416.2344"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="232.4238" x="508.0649" y="1431.373">Phase 4: Service Worker Takeover</text><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="239.3945" y1="1468.1719" y2="1468.1719"/><line style="stroke:#94A3B8;stroke-width:1;" x1="239.3945" x2="239.3945" y1="1468.1719" y2="1481.1719"/><line style="stroke:#94A3B8;stroke-width:1;" x1="198.3945" x2="239.3945" y1="1481.1719" y2="1481.1719"/><polygon fill="#94A3B8" points="208.3945,1477.1719,198.3945,1481.1719,208.3945,1485.1719,204.3945,1481.1719" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="211.002" x="204.3945" y="1463.3418">GET /auth/session-token (via relay)</text><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="239.3945" y1="1509.1406" y2="1509.1406"/><line style="stroke:#94A3B8;stroke-width:1;" x1="239.3945" x2="239.3945" y1="1509.1406" y2="1522.1406"/><line style="stroke:#94A3B8;stroke-width:1;" x1="198.3945" x2="239.3945" y1="1522.1406" y2="1522.1406"/><polygon fill="#94A3B8" points="208.3945,1518.1406,198.3945,1522.1406,208.3945,1526.1406,204.3945,1522.1406" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="145.3301" x="204.3945" y="1504.3105">Register Service Worker</text><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="239.3945" y1="1550.1094" y2="1550.1094"/><line style="stroke:#94A3B8;stroke-width:1;" x1="239.3945" x2="239.3945" y1="1550.1094" y2="1563.1094"/><line style="stroke:#94A3B8;stroke-width:1;" x1="198.3945" x2="239.3945" y1="1563.1094" y2="1563.1094"/><polygon fill="#94A3B8" points="208.3945,1559.1094,198.3945,1563.1094,208.3945,1567.1094,204.3945,1563.1094" style="stroke:#94A3B8;stroke-width:1;"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="176.8125" x="204.3945" y="1545.2793">SW.postMessage("dc_ready")</text><path d="M163,1576.1094 L163,1641.1094 L874,1641.1094 L874,1586.1094 L864,1576.1094 L163,1576.1094 " fill="#334155" style="stroke:#334155;stroke-width:1;"/><path d="M864,1576.1094 L864,1586.1094 L874,1586.1094 L864,1576.1094 " fill="#334155" style="stroke:#334155;stroke-width:1;"/><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="95.0391" x="354.7813" y="1592.248">From this point:</text><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="317.4375" x="354.7813" y="1606.2168">- Page navigations &#8594; HTTP relay (cookie-based auth)</text><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="318.9961" x="354.7813" y="1620.1855">- Sub-resource fetches &#8594; DataChannel (JWT injected)</text><text fill="#F8FAFC" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="215.9063" x="354.7813" y="1634.1543">- 10s DC timeout &#8594; fallback to relay</text><polygon fill="#94A3B8" points="185.3945,1662.9531,195.3945,1666.9531,185.3945,1670.9531,189.3945,1666.9531" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="26.6758" x2="191.3945" y1="1666.9531" y2="1666.9531"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="108.7207" x="33.6758" y="1662.123">Click link / API call</text><polygon fill="#94A3B8" points="830.0195,1690.9219,840.0195,1694.9219,830.0195,1698.9219,834.0195,1694.9219" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="197.3945" x2="836.0195" y1="1694.9219" y2="1694.9219"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="182.4668" x="204.3945" y="1690.0918">DataChannel: http_request</text><polygon fill="#94A3B8" points="1189.8623,1718.8906,1199.8623,1722.8906,1189.8623,1726.8906,1193.8623,1722.8906" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="842.0195" x2="1195.8623" y1="1722.8906" y2="1722.8906"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="130.8457" x="849.0195" y="1718.0605">Proxy (authenticated)</text><polygon fill="#94A3B8" points="853.0195,1746.8594,843.0195,1750.8594,853.0195,1754.8594,849.0195,1750.8594" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;stroke-dasharray:2.0,2.0;" x1="847.0195" x2="1200.8623" y1="1750.8594" y2="1750.8594"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" lengthAdjust="spacing" textLength="58.1719" x="859.0195" y="1746.0293">Response</text><polygon fill="#94A3B8" points="208.3945,1774.8281,198.3945,1778.8281,208.3945,1782.8281,204.3945,1778.8281" style="stroke:#94A3B8;stroke-width:1;"/><line style="stroke:#94A3B8;stroke-width:1;" x1="202.3945" x2="841.0195" y1="1778.8281" y2="1778.8281"/><text fill="#94A3B8" font-family="Segoe UI" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="192.1172" x="214.3945" y="1773.998">DataChannel: http_response</text><!--SRC=[bLPHRzis47xNhxXgm60dKHpRwPeQSuh4IReCIMh4plAm5G5DKJPhcLH9EeuR1DZJdeTXlx2_P4TAbkLOJhid2RplZjyTxpxobHcn2OCa9bnuXfkOGKTEafWP-oC4euPB0HSyOdHEqVhrpt-XAvKXCHW9tKRNy_IOYuGeCe573s10w7Yev5I47HbB1J_iHVKt3OAMa4La6fipAKncYWuY4j5LqnL1FdwF3IM3ctD_rTZZNnZK6xZOOv-dJ51ccLrmmOwb2fdAuZQR-_NNhyjGpydLMUDjSu38Bb66KvuGORuFjBBVuA0H_RGAA4lpI2avonRVxXDqMomMqBdXIfeN23jhQTBMKhRxeXZlCLwoEV0gxCModl1xZkQrM9k0wwoUF8zGWml-ZMRA1w9XYZzvIPDbGS4_na8jK8FqF-Uz0kprRwvmRtMVWRMPYdBaxT6PGyn8L0xe8-zEBCdOmGmjHzaAC16cpDB_7EYrsz0T4OsDsrgCJhljUIxFu33Ff0M_SSsD8njeHnvkhY-yXHsXBeyMl3_jGornaJot5Ao4IIsx8pE9DpcJXDSmPLtc_liZyB05Fjg31ty7GgvH7kPsBd7rSWv7IOBBMPeQ7NPtTp_2qyUIZ3enfsFmCoNn0QK4lUilqT8iHkWxtBtj6FoORTHsZYLyctiDgDtT3MeMK8Dje5AEETE5mZTQy4k_tuLhXeaWucXgHkuCDl1OHgjqNB2MRP0xPTrJLjMCoQ7hd1RSzbemCYP137QyDb1nuAfdpS4oV06d4ocGcwN_zQz_C7aaLOlb48LuKvO5oCOIvX0NrR5mVzZfxci3vKszAOfY99xe6XxiXYY9aWzpUmEiX_ePO-6SjE32iQXOA6SXc15An71aGrHVP4z97Dj3VqTboDeFyo_h7DAoPlkSFj0H4KC65WyHYecHs37wUUrjvjie2oOe7YgXb6czanrmXESo-gukirINhVRjHffnnFzwsyzy_by37UQgaWM6YjsV2PGWObY81StiGHwniRU7NNzviOYGhbwpcU9ukLiBPi759vmscB61CZIO9aD5GhRxIN-pRyjgP7Uia2I1XE1fR4CM3ZHLF37Lma0sCI8RNFSxS9DXAaJF1TqfF1-gpoTqkT4QNM0FZ4uDdiJwGLZgYWsvDhZy24h6LiTepB5wFZoLAYZX2ZlsqTOiLy8YDArb3ak3vL43Cg0MNavUi1bWvbrcxzNyXOMoXKDds8SeOgea2nqcTzBPLli6str6L5YmPyTTy2D2pmgEIof5vmoqCiPP37UT7dCHSZ74USRh1PhxRmwgVmWxZdW_K6alAvoUc3tmUmOa3B5FT5ciyyufK8AXGanMupp_RMDaHB2OsOATyQ9tckpMbdFFgdRFpHpeYE4DOrr6UB2GJ0MkXA-sjhnI_nDYI0VLGh0OFdHFhomkxyhzbdiqSChWLgenklR9cBdSDhRYKhOqPemd6JZnWSez9v2DSAdZzQ8bLxSi1_TkTnEfpILkWQDLyKEAWqZ2kOz39V2v1uvaXjz9NpFv8-nCoGcgBzVuCk3OfhWKu4iLHrIGUpuajl-qAw6x95EXhQGo5GomCA4Jkwhpwqq70Pwjd2ga7363rKvzYvMjM9rBfSLga_MhxsauwO3X4oQdndb4cSxRQyHjwba1i-bu6vyICHTZLB-ZxZdOQw9OhP8ZNfLKFEirCUswU-pROdgzaBr5X9nN-OOf6dVy3m00]--></g></svg>